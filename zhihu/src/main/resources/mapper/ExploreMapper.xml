<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <!-- 映射文件的命名空间namespace的值是，与这对应的映射接口的全类名 -->
<mapper namespace="com.yc.zhihu.mapper.ExploreMapper">
    <select id="list" parameterType="Users" resultType="Explore">
       select * from explore e,
          (select ids from dynstate PARTITION (GH) where selfid='${uids}')d
       where e.tid=d.ids
    </select>
    
    <select id="lists" parameterType="string" resultType="Explore">
       select * from explore where checks=#{s}
    </select>
    
    <select id="find" parameterType="Strings" resultType="Explore">
        select * from explore where ids=#{ids} and kind=#{kind}
    </select>
    
    <select id="findUpdate" resultType="Explore" >
	    select q.qid ids,'Q' kind,q.qtitle title,rd.rcontent content,q.qtid tid,rd.ttopic tname,rd.usign usign,rd.uids uids,rd.uname author,rd.rtime times,'n' checks  from QUESTION q,
	     (select * from topics t,
	       (select * from users u,
	          (select * from reply,
        	    (select ids id,count(ids) counts from DYNSTATE PARTITION (DH) group by ids order by count(ids))
	          where counts>0 and id=rid and rkind='Q' and rrid='')r
	        where u.uids=r.remitid)r
	      where t.tid=r.rtid)rd
	   where q.qid=rd.reqid
    </select>
    <select id="findUpdateE" resultType="Explore">
         select e.eid ids,'W' kind,e.etitle title,e.econtent content,e.etid tid,t.ttopic tname,e.usign usign,e.uids uids,e.uname author,e.etime times,'n' checks  from topics t,
	     (select * from users u,
	       (select * from essay,
           	 (select ids id,count(ids) counts from DYNSTATE PARTITION (DW) group by ids order by count(ids))
	        where counts>0 and id=eid )e
	      where u.uids=e.eautid)e
	    where t.tid=e.etid
    </select>
    
    <insert id="update" parameterType="Explore">
        insert into explore (ids,kind,title,content,tid,tname,uids,author,times,checks)
        values(#{ids},#{kind},#{title},#{content},#{tid},#{tname},#{uids},#{author},#{times},#{checks})
    </insert>
    
</mapper>